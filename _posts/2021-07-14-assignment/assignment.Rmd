---
title: "VAST Challenge 2021 MC2" 
description: |
  User performance analytics based on movement and purchase data.
author:
  - name: Youzhen Zhang
    url: https://example.com/norajones
date: 07-14-2021
output:
  distill::distill_article:
    self_contained: false
    toc: true
    toc_depth: 3
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.retina = 3,
                      echo = TRUE,
                      eval = TRUE,
                      message = FALSE,
                      warning = FALSE)
```

# 1. Introduction

### 1.1 Backgroud of the case

Several employees of GAStech go missing, the case is under investigation.

Many of the Abila, Kronos-based employees of GAStech have company cars which were installed geospatial tracking software to track data periodically as long as they are moving.

This vehicle tracking data has been made available to law enforcement to support their investigation. Unfortunately, data is not available for the day the GAStech employees went missing. Data is only available for the two weeks prior to the disappearance.

Also, Kronos based companies provide a Kronos Kares benefit card to GASTech employees giving them discounts and rewards in exchange for collecting information about their credit card purchases and preferences as recorded on loyalty cards. This data has been made available to investigators in the hopes that it can help resolve the situation.

### 1.2 Objectives of this report

The objectives of this case analysis report is to identify which GASTech employees made which purchases and identify suspicious patterns of behavior. 
During the analysis, 3 aspects were taken into consideration:

1. Using just the credit and loyalty card data, identify the most popular locations, and when they are popular. Also, recommendations should be given to correct these anomalies.

2. Add the vehicle data to analysis of the credit and loyalty card data and figure out the discrepancies between vehicle, credit, and loyalty card data.

3. Infer the owners of each credit card and loyalty card and provide the evidences for that.

# 2. Literature Review

In the literature review conducted, it was found that there were some geospatial data in the dataset. To delivery a clear analysis based on tracking movement trace, I examined how to visualise movement data by using appropriate R packages.

To get a better understanding about the relationship between employee and credit card, some network data visualisation and analysis techniques would be used. For example, build network graph visualisation using appropriate functions of ggraph.

# 3. Data Preperation

### 3.1 Install and load packages

We need to set up the environment and load all required packages first. The code chunk below will install the packages if not yet installed, and load them to the environment.

```{r}
packages = c('ggiraph', 'plotly', 'DT', 'patchwork',
             'tidyverse','raster', 'sf', 'igraph', 'tidygraph', 
             'ggraph', 'visNetwork', 
             'lubridate', 'clock','tmap','rmarkdown')

for (p in packages){
  if(!require(p, character.only = T)){
    install.packages(p)
  }
  library(p,character.only = T)
}
```

### 3.2 Import data

The data was loaded using read.csv() of the readr package, which reads delimited files into a tibble.

```{r}
cc_data <- read.csv("MC2/cc_data.csv")
loyalty_data <- read.csv("MC2/loyalty_data.csv")
gps <- read.csv("MC2/gps.csv")
```

### 3.3 Transform data

1. Change variables to the proper data type and create new variables for table merge.

```{r}
cc_data$timestamp <- date_time_parse(cc_data$timestamp,
                                 zone = "",
                                 format = "%d/%m/%Y %H:%M")

cc_data$date <- substr(cc_data$timestamp,1,10)

cc_data$date <- date_parse(cc_data$date,format = "%Y-%m-%d")

loyalty_data$date <- date_parse(loyalty_data$timestamp,
                                format = "%d/%m/%Y")
```

2. Merge data frames to get the view for credit and loyalty transaction data together.

```{r}
joint_cc_loyalty = cc_data %>% inner_join(loyalty_data,
                                          by=c('location','price','date'))

paged_table(joint_cc_loyalty)
```

3. Create new data frame to show the summarized data grouped by location.

for joint_data:

```{r}
sum_by_location <- joint_cc_loyalty %>%
select(location, price) %>%
group_by(location) %>%
summarise(total_price = sum(price), total_count = n()) %>%
arrange(desc(total_count), desc(total_price))

paged_table(sum_by_location)
```
for cc_data:

```{r}
sum_cc_data <- cc_data %>%
select(location, price) %>%
group_by(location) %>%
summarise(total_price = sum(price), total_count = n()) %>%
arrange(desc(total_count), desc(total_price))

paged_table(sum_cc_data)
```

for loyalty_data:

```{r}
sum_loyalty_data <- loyalty_data %>%
select(location, price) %>%
group_by(location) %>%
summarise(total_price = sum(price), total_count = n()) %>%
arrange(desc(total_count), desc(total_price))

paged_table(sum_loyalty_data)
```

4. plot data:
for joint:

```{r}
p <- ggplot(sum_by_location)  + 
    geom_bar(aes(x=location, y=total_count), stat="identity", fill="tan1", colour="sienna3")+
  geom_line(aes(x=location, y=total_price), stat="identity")+
  geom_text(aes(label=total_price, x=location, y=total_price), colour="black")+
  geom_text(aes(label=total_count, x=location, y=total_count), colour="black")+
  scale_y_continuous(sec.axis = sec_axis(~./max(sum_by_location$total_count)))
```

for cc_data:

```{r}

```



```{r}
glimpse(joint_cc_loyalty)
glimpse(cc_data)
glimpse(loyalty_data)

```


# 4. Proposed Visualisation

# 5. Insights
